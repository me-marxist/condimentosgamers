<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Estação Sigilo — Microforum Privado (Anos 2000)</title>
  <style>
    /* Vibe anos 2000: cores berrantes, bordas 3D, tabelas, marquee */
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    :root{
      --bg:#0b1020;
      --panel:#f6f3e8;
      --accent:#ff00aa;
      --shadow:#c3c3c3;
      --muted:#666;
    }
    html,body{height:100%;margin:0;background:linear-gradient(90deg,#071028 0%, #071a2a 50%, #0b1020 100%);font-family: Arial, Helvetica, sans-serif;color:#111}
    .wrap{max-width:1000px;margin:14px auto;padding:12px;background:repeating-linear-gradient(45deg,#111 0 2px,#0f1622 2px 4px);border:6px groove #888;border-radius:8px}
    header{display:flex;align-items:center;gap:12px}
    .logo{display:flex;align-items:center;gap:8px}
    .logo .badge{background:var(--accent);color:white;padding:6px 10px;font-weight:bold;border-radius:4px;box-shadow:2px 2px 0 var(--shadow)}
    .title{font-family:'Press Start 2P',monospace;color:#fff;font-size:14px}
    nav{margin-left:auto}
    nav a{color:#fff;text-decoration:none;padding:6px 10px;border:2px outset #333;background:linear-gradient(#444,#222);margin-left:6px;border-radius:6px}

    .grid{display:grid;grid-template-columns:320px 1fr;gap:12px;margin-top:12px}
    /* left column */
    .card{background:var(--panel);padding:10px;border:4px ridge #aaa;border-radius:6px}
    .profile-pic{width:100%;height:220px;background:#ddd;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .profile-pic img{width:100%;height:100%;object-fit:cover}
    .muted{color:var(--muted);font-size:13px}

    /* feed */
    .composer textarea{width:100%;height:80px;border:2px inset #444;padding:8px;border-radius:6px;background:#fff}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:2px outset #333;background:linear-gradient(#eee,#ddd);cursor:pointer}
    .post{background:#fff;padding:10px;border:2px solid #ccc;margin-bottom:8px;border-radius:4px}
    .post .meta{font-size:12px;color:#444;margin-bottom:6px}
    .avatar-sm{width:46px;height:46px;border-radius:4px;object-fit:cover;border:2px solid #666}

    /* retro footer */
    footer{margin-top:12px;color:#ddd;font-size:12px;text-align:center}

    /* marquee */
    .marq{background:#000;color:#0f0;padding:6px;font-family:monospace;border:2px inset #333}

    /* small forms */
    input[type=text],input[type=password],input[type=url]{width:100%;padding:6px;margin-bottom:8px;border:2px inset #777}
    label{font-weight:bold;font-size:13px}

    /* tiny mobile adjustments */
    @media (max-width:800px){.grid{grid-template-columns:1fr}.profile-pic{height:180px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <div class="badge">ESTAÇÃO</div>
        <div class="title">Microforum Privado — vibes fórum 2000</div>
      </div>
      <nav id="navArea"></nav>
    </header>

    <div class="marq"><marquee behavior="scroll" direction="left">Bem-vindo ao microforum privado — aqui é sujo, barulhento e glorioso como internet dos anos 2000!</marquee></div>

    <div class="grid">
      <aside>
        <div class="card" id="panelAuth">
          <!-- login / signup forms (JS will manage visibility) -->
          <div id="authForms"></div>
        </div>

        <div class="card" style="margin-top:12px" id="profileCard" hidden>
          <div class="profile-pic" id="profilePicBox"> <span class="muted">Sem foto de perfil</span></div>
          <h3 id="profileName">Usuário</h3>
          <p class="muted" id="profileBio">Bio vazia. Edite seu perfil para adicionar algo doentio aqui.</p>
          <button class="btn" onclick="openEditProfile()">Editar perfil</button>
          <hr>
          <div>
            <label>Vídeo do botão (YouTube ID ou URL)</label>
            <input type="text" id="videoField" placeholder="ex: sRoPaZE5A7o (ou URL completo)">
            <button class="btn" onclick="saveVideoId()">Salvar vídeo</button>
            <div style="margin-top:8px"><button class="btn" onclick="playSiteVideo()">▶ Tocar vídeo do site</button></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4>Sobre</h4>
          <p class="muted">Este microforum é 100% client-side. Tudo fica no seu navegador (localStorage). Compartilhe com quem você confia copiando o HTML para um servidor local.</p>
        </div>
      </aside>

      <main>
        <section class="card" id="feedCard">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
            <img src="" id="composerAvatar" class="avatar-sm" style="display:none">
            <div style="flex:1">
              <div id="composerArea"></div>
            </div>
          </div>

          <div id="feedList"></div>
        </section>

        <section class="card" style="margin-top:12px">
          <h4>Recados & Logs</h4>
          <div id="logBox" style="font-family:monospace;font-size:12px;max-height:150px;overflow:auto;background:#eee;padding:6px;border:2px inset #ccc"></div>
        </section>
      </main>
    </div>

    <footer>
      <small>Construído com amor por um nostálgico. Arquive este arquivo e abra no navegador para usar.</small>
    </footer>

  </div>

  <!-- modal area for video & profile edit -->
  <div id="modalRoot" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:9999">
    <div style="width:90%;max-width:900px;background:#fff;padding:12px;border-radius:8px;position:relative">
      <button onclick="closeModal()" style="position:absolute;right:8px;top:8px" class="btn">Fechar</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    // --- storage helpers ---
    function load(key, fallback){try{const v=localStorage.getItem(key);return v?JSON.parse(v):fallback}catch(e){return fallback}}
    function save(key,value){localStorage.setItem(key,JSON.stringify(value))}

    // initialize
    const DB_USERS = 'mf_users_v1'
    const DB_POSTS = 'mf_posts_v1'
    const DB_SESSION = 'mf_session_v1'
    const DB_VIDEO  = 'mf_vid_v1'

    let users = load(DB_USERS, {}); // {username: {pass, name, bio, avatarDataUrl}}
    let posts = load(DB_POSTS, []); // [{id, user, text, ts}]
    let session = load(DB_SESSION, null);

    // --- tiny utils ---
    function q(id){return document.getElementById(id)}
    function nowTs(){return new Date().toISOString()}
    function log(msg){const lb=q('logBox');lb.innerHTML = '['+new Date().toLocaleTimeString()+'] '+msg+'<br>'+lb.innerHTML}

    // --- auth UI ---
    function renderAuth(){
      const container = q('authForms')
      if(session){
        container.innerHTML = `<p>Conectado como <strong>${escapeHtml(session.user)}</strong></p>
          <button class="btn" onclick="logout()">Logout</button>`
        q('navArea').innerHTML = `<a href="#" onclick="openProfile(session.user)">Perfil</a><a href="#" onclick="logout()">Sair</a>`
        q('profileCard').hidden = false
        renderProfileCard()
        renderComposer()
      } else {
        q('navArea').innerHTML = `<a href='#' onclick="showLogin()">Login</a> <a href='#' onclick="showSignup()">Criar conta</a>`
        q('profileCard').hidden = true
        q('composerArea').innerHTML = `<div class=muted>Faça login para postar.</div>`
        container.innerHTML = `
          <div id="loginBox">
            <label>Usuário</label>
            <input type="text" id="loginUser">
            <label>Senha</label>
            <input type="password" id="loginPass">
            <div style="margin-top:8px">
              <button class="btn" onclick="doLogin()">Entrar</button>
              <button class="btn" onclick="showSignup()">Criar conta</button>
            </div>
          </div>
        `
      }
    }

    function showLogin(){renderAuth()}
    function showSignup(){
      q('authForms').innerHTML = `
        <label>Usuário (sem espaços)</label>
        <input type="text" id="suUser">
        <label>Senha</label>
        <input type="password" id="suPass">
        <label>Nome para exibir</label>
        <input type="text" id="suName">
        <button class="btn" onclick="doSignup()">Criar conta</button>
        <button class="btn" onclick="renderAuth()">Cancelar</button>
      `
    }

    function doSignup(){
      const u = q('suUser').value.trim(); const p = q('suPass').value; const n = q('suName').value || u
      if(!u || !p){alert('Usuário e senha obrigatórios');return}
      if(users[u]){alert('Usuário já existe') ; return}
      users[u] = {pass:p, name:n, bio:'', avatar:null}
      save(DB_USERS, users)
      log('Conta criada: '+u)
      alert('Conta criada — faça login')
      renderAuth()
    }

    function doLogin(){
      const u=q('loginUser').value.trim(); const p=q('loginPass').value
      if(!users[u] || users[u].pass!==p){alert('Usuário ou senha incorretos');return}
      session = {user:u, ts:nowTs()}
      save(DB_SESSION, session)
      log('Login: '+u)
      renderAuth()
      renderFeed()
    }

    function logout(){session=null;localStorage.removeItem(DB_SESSION);renderAuth();renderFeed();log('Logout')}

    // --- profile & avatar ---
    function renderProfileCard(){
      if(!session) return
      const u = users[session.user]
      q('profileName').innerText = u.name || session.user
      q('profileBio').innerText = u.bio || 'Bio vazia. Edite seu perfil.'
      const avatarBox = q('profilePicBox')
      avatarBox.innerHTML = ''
      if(u.avatar){ const img=document.createElement('img'); img.src=u.avatar; avatarBox.appendChild(img)} else {avatarBox.innerHTML='<span class="muted">Sem foto de perfil</span>'}
      q('composerAvatar').style.display = u.avatar ? 'block' : 'none'
      if(u.avatar){q('composerAvatar').src = u.avatar}
      const vid = load(DB_VIDEO,null)
      q('videoField').value = vid || ''
    }

    function openEditProfile(){
      const u = users[session.user]
      const html = `
        <h3>Editar perfil — ${escapeHtml(session.user)}</h3>
        <label>Nome para exibir</label>
        <input type="text" id="editName" value="${escapeHtml(u.name||'')}">
        <label>Bio</label>
        <input type="text" id="editBio" value="${escapeHtml(u.bio||'')}">
        <label>Foto de perfil (arquivo)</label>
        <input type="file" id="editAvatar" accept="image/*">
        <div style="margin-top:8px"><button class="btn" onclick="saveProfile()">Salvar</button></div>
      `
      showModal(html)
      // wire file preview
      q('editAvatar').addEventListener('change', function(e){
        const f=e.target.files[0]; if(!f) return
        const r=new FileReader(); r.onload=function(){
          const prev=document.createElement('img'); prev.style.maxWidth='120px'; prev.src=r.result
          const mc = q('modalContent'); mc.appendChild(prev)
        }; r.readAsDataURL(f)
      })
    }

    function saveProfile(){
      const n = q('editName').value; const b = q('editBio').value; const f = q('editAvatar').files[0]
      if(f){const r=new FileReader(); r.onload=function(){users[session.user].avatar = r.result; users[session.user].name=n; users[session.user].bio=b; save(DB_USERS,users); renderProfileCard(); closeModal(); log('Perfil atualizado com avatar'); renderFeed();}; r.readAsDataURL(f)} else {users[session.user].name=n; users[session.user].bio=b; save(DB_USERS,users); renderProfileCard(); closeModal(); log('Perfil atualizado');}
    }

    // open someone's profile (read-only)
    function openProfile(username){
      const u = users[username]
      if(!u){alert('Usuário não encontrado');return}
      const html = `<div style='display:flex;gap:10px'><div style='width:140px'>${u.avatar?'<img src="'+u.avatar+'" style="width:140px;height:140px;object-fit:cover">':'<div style="width:140px;height:140px;background:#eee;display:flex;align-items:center;justify-content:center">Sem foto</div>'}</div><div><h3>${escapeHtml(u.name)}</h3><p class=muted>${escapeHtml(u.bio)}</p><p class=muted>Usuário: ${escapeHtml(username)}</p></div></div>`
      showModal(html)
    }

    // --- composer & feed ---
    function renderComposer(){
      if(!session) { q('composerArea').innerHTML = '<div class="muted">Faça login para postar</div>'; return }
      q('composerArea').innerHTML = `
        <div class="composer">
          <textarea id="postText" placeholder="Escreva algo doentio... (máx 280 chars)" maxlength="280"></textarea>
          <div style="margin-top:8px">
            <button class="btn" onclick="createPost()">Postar</button>
            <button class="btn" onclick="clearPosts()">Limpar feed (local)</button>
          </div>
        </div>
      `
    }

    function createPost(){
      const t = q('postText').value.trim(); if(!t) return alert('Escreva algo!')
      const p = {id:Date.now(), user:session.user, text:t, ts:nowTs()}
      posts.unshift(p); save(DB_POSTS,posts); q('postText').value=''; log('Post criado'); renderFeed()
    }

    function clearPosts(){ if(!confirm('Apagar todos os posts locais?')) return; posts=[]; save(DB_POSTS,posts); renderFeed(); log('Feed limpo') }

    function renderFeed(){
      const box = q('feedList'); box.innerHTML=''
      if(posts.length===0){box.innerHTML='<div class="muted">Nenhum post ainda — seja o primeiro</div>';return}
      posts.forEach(p=>{
        const user = users[p.user] || {name:p.user, avatar:null}
        const postEl = document.createElement('div'); postEl.className='post'
        postEl.innerHTML = `
          <div style="display:flex;gap:8px;align-items:flex-start">
            <div style="width:56px"><img src="${user.avatar || 'data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=56 height=56><rect width=100% height=100% fill=%23ddd /></svg>'}" class="avatar-sm"></div>
            <div style="flex:1">
              <div class="meta"><strong>${escapeHtml(user.name)}</strong> • <span class="muted">${timeAgo(new Date(p.ts))}</span> • <a href='#' onclick='openProfile("${escapeJs(p.user)}")'>@${escapeHtml(p.user)}</a></div>
              <div>${escapeHtml(p.text).replace(/\n/g,'<br>')}</div>
            </div>
          </div>
        `
        box.appendChild(postEl)
      })
    }

    // --- tiny helpers for safety and display ---
    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;') }
    function escapeJs(s){ return String(s).replace(/\\/g,'\\\\').replace(/"/g,'\"').replace(/'/g,"\\'") }

    function timeAgo(d){ const now=new Date(); const diff=(now-d)/1000; if(diff<60) return Math.floor(diff)+'s'; if(diff<3600) return Math.floor(diff/60)+'m'; if(diff<86400) return Math.floor(diff/3600)+'h'; return d.toLocaleString() }

    // --- modal ---
    function showModal(html){ q('modalContent').innerHTML = html; q('modalRoot').style.display='flex' }
    function closeModal(){ q('modalRoot').style.display='none'; q('modalContent').innerHTML = '' }

    // --- video player ---
    function saveVideoId(){ const raw=q('videoField').value.trim(); if(!raw) {localStorage.removeItem(DB_VIDEO); alert('Vídeo removido'); return} const id = extractYouTubeId(raw); save(DB_VIDEO,id); alert('Vídeo salvo: '+id) }
    function extractYouTubeId(s){ if(!s) return '';
      // Accept plain id or full URL
      const urlMatch = s.match(/[?&]v=([a-zA-Z0-9_-]{6,})/) || s.match(/youtu\.be\/([a-zA-Z0-9_-]{6,})/) || s.match(/embed\/([a-zA-Z0-9_-]{6,})/)
      if(urlMatch) return urlMatch[1]; if(s.length>=6 && s.length<50) return s; return s
    }
    function playSiteVideo(){ const id = load(DB_VIDEO,null); if(!id) return alert('Nenhum vídeo salvo — cole um YouTube ID nas configurações de perfil')
      showModal(`<div style="position:relative;padding-top:56.25%"><iframe src="https://www.youtube.com/embed/${escapeHtml(id)}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" style="position:absolute;inset:0;width:100%;height:100%"></iframe></div>`)
    }

    // --- misc: small UI actions ---
    function openSiteVideoButton(){ /* for future use */ }

    // --- boot ---
    function boot(){ renderAuth(); renderFeed(); if(session && users[session.user] && users[session.user].avatar) q('composerAvatar').src=users[session.user].avatar }
    boot()

    // small utility: open modal to play arbitrary video button from feed (optional)

    // --- escape some characters for HTML in attributes ---

    // expose a couple functions to global for inline onclicks
    window.openProfile = openProfile
    window.showLogin = showLogin
    window.showSignup = showSignup
    window.doLogin = doLogin
    window.doSignup = doSignup
    window.logout = logout
    window.openEditProfile = openEditProfile
    window.createPost = createPost
    window.clearPosts = clearPosts
    window.saveVideoId = saveVideoId
    window.playSiteVideo = playSiteVideo
    window.closeModal = closeModal

    // tiny warning: everything is local-only
    log('Microforum iniciado — tudo salvo localmente no navegador')
  </script>
</body>
</html>

